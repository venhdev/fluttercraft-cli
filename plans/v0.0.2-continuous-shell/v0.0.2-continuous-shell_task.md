# v0.0.2-continuous-shell Task Breakdown

## Overview
Transform CLI from single-command mode to interactive continuous shell.

---

## Phase 1 — Foundation: Interactive Shell Loop
**Status**: ✅ COMPLETE | **Priority**: HIGH

### Tasks
- [x] Create `lib/src/ui/` directory structure
- [x] Implement `lib/src/ui/shell.dart` REPL loop
  - [x] Prompt display (`mycli> `)
  - [x] Input reading
  - [x] Command routing
  - [x] Error handling (no exit on error)
- [x] Implement built-in shell commands
  - [x] `help` - list available commands
  - [x] `exit` / `quit` - exit shell
  - [x] `clear` - clear screen
- [x] Create `lib/src/core/command_registry.dart`
  - [x] Map<String, Command> structure
  - [x] Register existing commands
- [x] Modify `bin/mobile_build_cli.dart`
  - [x] Add `--shell` flag
  - [x] Add `--interactive-mode` flag (arrow|numeric)
  - [x] Default to shell mode when no args
  - [x] Single-command mode when args provided
- [ ] Write unit tests for shell

---

## Phase 2 — Arrow-Key Interactive Menus
**Status**: Not Started | **Priority**: HIGH

### Tasks
- [ ] Create `lib/src/utils/terminal_helper.dart`
  - [ ] Raw mode enable/disable
  - [ ] Platform detection
  - [ ] Escape sequence constants
- [ ] Create `lib/src/ui/menu.dart` with two modes
  - [ ] `Menu.select()` method with mode parameter
  - [ ] **Arrow Mode** implementation:
    - [ ] Highlight current option with `>`
    - [ ] Arrow key navigation (up/down)
    - [ ] Enter to select
    - [ ] Raw terminal mode handling
  - [ ] **Numeric Mode** implementation:
    - [ ] Numbered list display: `1) option_a`
    - [ ] Read number input
    - [ ] Validate selection
- [ ] Create `InteractiveMode` enum (arrow, numeric)
- [ ] Test menu on:
  - [ ] Windows PowerShell (both modes)
  - [ ] Windows CMD (numeric mode)
  - [ ] Git Bash / WSL (arrow mode)

---

## Phase 3 — Multi-Step Command Workflows
**Status**: Not Started | **Priority**: MEDIUM

### Tasks
- [ ] Create `lib/src/flows/` directory
- [ ] Implement `lib/src/flows/flow_context.dart`
  - [ ] Store selected values
  - [ ] Step navigation (back/skip/cancel)
- [ ] Implement `lib/src/flows/build_flow.dart`
  - [ ] Step 1: Select target (apk/aab/ipa)
  - [ ] Step 2: Select flavor (dev/staging/prod)
  - [ ] Step 3: Optional dart-defines
  - [ ] Step 4: Show summary
  - [ ] Step 5: Execute build
- [ ] Integrate build flow with shell
- [ ] Add flow support to `build` command

---

## Phase 4 — Shared Runtime Context
**Status**: Not Started | **Priority**: MEDIUM

### Tasks
- [ ] Create `lib/src/core/app_context.dart`
  - [ ] Load `.buildenv` once
  - [ ] Load `pubspec.yaml` info
  - [ ] Cache project paths
- [ ] Modify shell to load context at startup
- [ ] Pass context to:
  - [ ] Command handlers
  - [ ] Flow executors
  - [ ] Menu selectors
- [ ] Update existing commands to use context
  - [ ] `build_command.dart`
  - [ ] `clean_command.dart`
  - [ ] `gen_env_command.dart`
  - [ ] `convert_command.dart`

---

## Phase 5 — UX Polish
**Status**: Not Started | **Priority**: LOW

### Tasks
- [ ] Add colors to menu (using `ansicolor`)
  - [ ] Highlighted option in green/cyan
  - [ ] Header styling
  - [ ] Error messages in red
- [ ] Create `lib/src/ui/spinner.dart`
  - [ ] Animated spinner characters
  - [ ] Status message display
  - [ ] Success/failure indicators
- [ ] Create `lib/src/ui/keyboard.dart`
  - [ ] `q` → quit
  - [ ] `c` → cancel
  - [ ] `←` → back
- [ ] Add startup banner
  - [ ] Version display
  - [ ] Welcome message
- [ ] Optional: command history file

---

## Phase 6 — Packaging & Distribution
**Status**: Not Started | **Priority**: LOW

### Tasks
- [ ] Create `scripts/compile.ps1`
  - [ ] Windows compilation
  - [ ] macOS/Linux compilation (if applicable)
- [ ] Test compiled executable
  - [ ] Shell mode
  - [ ] Single-command mode
  - [ ] Menu selection
- [ ] Update `README.md`
  - [ ] Interactive shell documentation
  - [ ] Installation instructions
  - [ ] Usage examples
- [ ] Update `CHANGELOG.md` with v0.0.2 changes

---

## Dependencies Between Phases

```
Phase 1 (Shell) ──────┬──► Phase 2 (Menus) ──► Phase 3 (Flows)
                      │
                      └──► Phase 4 (Context)
                                │
                                ▼
                          Phase 5 (Polish) ──► Phase 6 (Package)
```

- **Phase 1** must complete before anything else
- **Phase 2** requires Phase 1 (shell to host menus)
- **Phase 3** requires Phase 2 (menus for selection)
- **Phase 4** can run in parallel with Phase 2-3
- **Phase 5** requires Phase 1-4 complete
- **Phase 6** is final step after all others

---

## Success Criteria

| Criteria | Metric |
|----------|--------|
| Shell starts | `mycli` with no args opens shell |
| Commands work | All existing commands function in shell |
| Arrow mode works | `--interactive-mode arrow` enables arrow navigation |
| Numeric mode works | `--interactive-mode numeric` enables number selection |
| Build wizard | Multi-step flow completes successfully |
| No regressions | Single-command mode still works |
| Tests pass | All new tests green |
