# v0.1.3 Implementation Plan

Add `dart_define_from_file` support to interactive shell UI.

## Background

The `dart_define_from_file` feature was implemented in v0.1.2 at the config layer (`BuildConfig` and `FlavorConfig`), but it's not exposed in the shell UI's info display. Users cannot see which file is being used for dart defines when running `info -v` in the shell.

---

## Proposed Changes

### Phase 1 — Expose dart_define_from_file in AppContext

#### [MODIFY] [app_context.dart](file:///c:/src/self/flutter-dart/cli/fluttercraft/lib/src/core/app_context.dart)

Add a getter to expose `dartDefineFromFile` from `BuildConfig`:

```dart
// Add after line 111 (after finalDartDefine getter)

/// Dart define from file path (if specified)
String? get dartDefineFromFile => config.dartDefineFromFile;
```

**Rationale**: Follow existing pattern where `AppContext` exposes `BuildConfig` properties as convenience getters (lines 93-129).

---

### Phase 2 — Update Shell UI Display

#### [MODIFY] [shell.dart](file:///c:/src/self/flutter-dart/cli/fluttercraft/lib/src/ui/shell.dart)

Update `_showInfo` method to display `dart_define_from_file` in verbose mode:

**Location**: After line 248 (in the "Dart Define" section)

```dart
// Show dart_define_from_file if specified
if (ctx.dartDefineFromFile != null) {
  console.keyValue('Define From File', ctx.dartDefineFromFile!, keyWidth: kw);
}

// Dart defines (only if present)
if (ctx.finalDartDefine.isNotEmpty) {
  console.section('Dart Define');
  
  // Show dart_define_from_file source first
  if (ctx.dartDefineFromFile != null) {
    console.keyValue('From File', ctx.dartDefineFromFile!, keyWidth: kw);
  }
  
  for (final entry in ctx.finalDartDefine.entries) {
    console.keyValue(entry.key, entry.value.toString(), keyWidth: kw);
  }
}
```

**Rationale**: Display the file path before showing individual defines so users understand where the values come from.

---

### Phase 3 — Version Bump

#### [MODIFY] [pubspec.yaml](file:///c:/src/self/flutter-dart/cli/fluttercraft/pubspec.yaml)

```diff
- version: 0.1.2
+ version: 0.1.3
```

#### [MODIFY] [version.dart](file:///c:/src/self/flutter-dart/cli/fluttercraft/lib/src/version.dart)

```diff
- const String appVersion = '0.1.2';
+ const String appVersion = '0.1.3';
```

---

## Verification Plan

### Automated Tests

No new unit tests required - this is a display-only change that uses existing config data.

**Verify existing tests still pass:**
```powershell
fvm dart test --reporter=json > test/test_output.json
```

### Static Analysis

```powershell
fvm dart analyze 2>&1 | Select-String -Pattern "error|warning" | Select-Object -First 50
```

### Manual Verification

#### Test 1: Shell Info Display Without dart_define_from_file
1. Open a Flutter project without `dart_define_from_file` configured
2. Run: `flc` (start shell)
3. Type: `info -v`
4. **Expected**: 
   - "Dart Define" section appears if defines exist
   - No "From File" line shown
   - Individual defines displayed normally

#### Test 2: Shell Info Display With dart_define_from_file
1. Create/open `fluttercraft.yaml` with:
   ```yaml
   build:
     dart_define_from_file: .env.prod
   ```
2. Run: `flc` (start shell)
3. Type: `info -v`
4. **Expected**: 
   - "Dart Define" section shows
   - First line: `From File       .env.prod`
   - Followed by individual dart define key-value pairs

#### Test 3: Flavor-Specific dart_define_from_file
1. Configure flavor with override:
   ```yaml
   build:
     dart_define_from_file: .env
   
   flavors:
     dev:
       dart_define_from_file: .env.dev
   ```
2. Run: `flc` with dev flavor
3. Type: `info -v`
4. **Expected**: Shows `.env.dev` (flavor override takes precedence)

---

## Breaking Changes

None - this is a backward-compatible UI enhancement.
