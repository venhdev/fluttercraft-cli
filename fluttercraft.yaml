# fluttercraft.yaml - Build Configuration
# Generated by fluttercraft CLI
#
# App name and version are ALWAYS read from pubspec.yaml
# This file only contains build-specific settings

# ──────────────────────────────────────────────────────────────────────────────
# ROOT KEY (required for all config files)
# ──────────────────────────────────────────────────────────────────────────────
fluttercraft:
  # ════════════════════════════════════════════════════════════════════════════
  # BASE BUILD CONFIGURATION (anchor for inheritance)
  # ════════════════════════════════════════════════════════════════════════════
  build_defaults: &build_defaults
    # Platform: aab | apk | ipa | ios | app
    platform: aab
    # Main entry point
    target: lib/main.dart

    # Extra arguments to pass to the build command (e.g., --obfuscate, --split-debug-info=...)
    args: []

    # ──────────────────────────────────────────────────────────────────────────
    # Dart Define - Always added to build command
    # ──────────────────────────────────────────────────────────────────────────
    global_dart_define: {}

    # Flavor/build-specific dart defines (merged with global)
    dart_define: {}

    # Path to .env or .json file for dart defines (optional)
    # Can be overridden by flavor-specific dart_define_from_file
    # Example: .env, .env.dev, config.json
    dart_define_from_file: null

    # ──────────────────────────────────────────────────────────────────────────
    # Build Flags
    # ──────────────────────────────────────────────────────────────────────────
    flags:
      # Prompt for custom dart-define values during build
      should_prompt_dart_define: false
      # Run flutter clean before build
      should_clean: false
      # Run build_runner before build
      should_build_runner: false

  # ════════════════════════════════════════════════════════════════════════════
  # ACTIVE BUILD CONFIGURATION
  # ════════════════════════════════════════════════════════════════════════════
  build:
    <<: *build_defaults

    # Active flavor: null | dev | staging | prod
    # If set, overrides from flavors section are applied
    flavor: null

  # ════════════════════════════════════════════════════════════════════════════
  # FLAVOR OVERRIDES (NO VERSION OVERRIDES - use dart_define to detect flavor)
  # ════════════════════════════════════════════════════════════════════════════
  flavors:
    dev:
      platform: apk
      flags:
        should_prompt_dart_define: false
      dart_define:
        FLAVOR: dev
        IS_DEV: true
        LOG_LEVEL: debug
      # Override with flavor-specific env file (optional)
      # dart_define_from_file: .env.dev

    staging:
      platform: aab
      flags:
        should_prompt_dart_define: false
        should_clean: true
      dart_define:
        FLAVOR: staging
        IS_STAGING: true

    prod:
      platform: aab
      flags:
        should_prompt_dart_define: false
        should_clean: true
        should_build_runner: true
      dart_define:
        FLAVOR: prod
        IS_PROD: true

  # ════════════════════════════════════════════════════════════════════════════
  # ENVIRONMENT TOOLS (global only - not overridable by flavors)
  # ════════════════════════════════════════════════════════════════════════════
  environments:
    # FVM integration
    fvm:
      enabled: true
      # Pinned Flutter version (auto-detected from .fvmrc if null)
      version: 3.35.3

    # Shorebird integration
    shorebird:
      enabled: true
      # App ID (auto-detected from shorebird.yaml)
      app_id: 12345678-f1f1-f2f2-f3f3-f4f4f4f4f4f4
      # @read-only [build:platform] - Artifact type derived from build.platform
      artifact: null
      # Skip confirmation prompts (maps to --no-confirm)
      no_confirm: true

    # Bundletool (AAB → APK conversion)
    bundletool:
      # Path to bundletool.jar (optional)
      path: null
      # Path to key.properties file
      keystore: android/key.properties

    # Disable colors in console output
    no_color: false

  # ════════════════════════════════════════════════════════════════════════════
  # OUTPUT PATHS
  # ════════════════════════════════════════════════════════════════════════════
  paths:
    # Note: if flavor is set, output becomes .fluttercraft/dist/<flavor>/
    output: .fluttercraft/dist

  # ════════════════════════════════════════════════════════════════════════════
  # CUSTOM COMMAND ALIASES
  # ════════════════════════════════════════════════════════════════════════════
  alias:
    gen-icon:
      cmds:
        - fvm flutter pub get
        - fvm flutter pub run flutter_launcher_icons
    brn:
      cmds:
        - fvm flutter pub get
        - fvm flutter packages pub run build_runner build --delete-conflicting-outputs
